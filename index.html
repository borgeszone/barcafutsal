<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gestión de Jugadores</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="" />
  </head>
  <body class="position-relative">
    <div class="container">
      <div class="row">
        <!-- S1: Lista de Jugadores -->
        <div class="col-md-4 border-end p-5 position-relative" id="s1">
          <h5>Jugadors</h5>
          <div
            class="row row-cols-2 row-cols-sm-3 row-cols-md-3 row-cols-lg-3 jugadores-lista"
          >
            <div
              class="col text-center jugador-card"
              data-nombre="Dídac"
              data-numero="21"
              data-posicion="Portero"
              data-edad="27"
              data-img="/images/didac.jpg"
            >
              <img src="/images/didac.jpg" class="img-thumbnail" />
              <p class="small">21 - Dídac</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Miquel Feixas"
              data-numero="26"
              data-posicion="Portero"
              data-edad="27"
              data-img="/images/feixas.jpg"
            >
              <img
                src="/images/feixas.jpg"
                alt="Miquel Feixas"
                class="img-thumbnail"
              />
              <p class="small">26 - Feixas</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Iker"
              data-numero="3"
              data-posicion="Portero"
              data-edad="27"
              data-img="/images/iker.jpg"
            >
              <img src="/images/iker.jpg" alt="Iker" class="img-thumbnail" />
              <p class="small">3 - Iker</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Antonio"
              data-numero="6"
              data-posicion="Cierre"
              data-edad="27"
              data-img="/images/antonio.jpg"
            >
              <img
                src="/images/antonio.jpg"
                alt="Antonio"
                class="img-thumbnail"
              />
              <p class="small">6 - Antonio</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Erick"
              data-numero="17"
              data-posicion="Cierre"
              data-edad="27"
              data-img="/images/erick.jpg"
            >
              <img src="/images/erick.jpg" alt="Erick" class="img-thumbnail" />
              <p class="small">17 - Erick</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Matheus"
              data-numero="3"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/matheus.jpg"
            >
              <img
                src="/images/matheus.jpg"
                alt="Matheus"
                class="img-thumbnail"
              />
              <p class="small">3 - Matheus</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Adolfo"
              data-numero="8"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/adolfo.jpg"
            >
              <img
                src="/images/adolfo.jpg"
                alt="Adolfo"
                class="img-thumbnail"
              />
              <p class="small">8 - Adolfo</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Joao"
              data-numero="9"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/joao.jpg"
            >
              <img src="/images/joao.jpg" alt="Lozano" class="img-thumbnail" />
              <p class="small">5 - Joao</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Catela"
              data-numero="13"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/catela.jpg"
            >
              <img
                src="/images/catela.jpg"
                alt="Catela"
                class="img-thumbnail"
              />
              <p class="small">13 - Catela</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="Martel"
              data-numero="14"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/martel.jpg"
            >
              <img
                src="/images/martel.jpg"
                alt="Martel"
                class="img-thumbnail"
              />
              <p class="small">14 - Martel</p>
            </div>
            <div
              class="col text-center jugador-card"
              data-nombre="S. González"
              data-numero="16"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/sergio.jpg"
            >
              <img
                src="/images/sergio.jpg"
                alt="S. González"
                class="img-thumbnail"
              />
              <p class="small">16 - S. González</p>
            </div>
            <!-- 20 - Touré -->
            <div
              class="col text-center jugador-card"
              data-nombre="Touré"
              data-numero="20"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/toure.jpg"
            >
              <img src="/images/toure.jpg" alt="Touré" class="img-thumbnail" />
              <p class="small">20 - Touré</p>
            </div>
            <!-- 22 - Khalid -->
            <div
              class="col text-center jugador-card"
              data-nombre="Luciano"
              data-numero="22"
              data-posicion="Ala"
              data-edad="27"
              data-img="/images/luciano.jpg"
            >
              <img
                src="/images/luciano.jpg"
                alt="Luciano"
                class="img-thumbnail"
              />
              <p class="small">22 - Luciano</p>
            </div>
            <!-- 10 - Pito -->
            <div
              class="col text-center jugador-card"
              data-nombre="Pito"
              data-numero="10"
              data-posicion="Pivote"
              data-edad="27"
              data-img="/images/pito.jpg"
            >
              <img src="/images/pito.jpg" alt="Pito" class="img-thumbnail" />
              <p class="small">10 - Pito</p>
            </div>
            <!-- 19 - Fits -->
            <div
              class="col text-center jugador-card"
              data-nombre="Fits"
              data-numero="19"
              data-posicion="Pivote"
              data-edad="27"
              data-img="images/fits.jpg"
            >
              <img src="images/fits.jpg" alt="Fits" class="img-thumbnail" />
              <p class="small">19 - Fits</p>
            </div>
            <!-- Botón para añadir nuevo jugador -->
            <div
              id="add-jugador-btn"
              class="jugador-card text-center border rounded p-2 d-flex flex-column align-items-center justify-content-center add-jugador-card"
              style="cursor: pointer; background-color: #f0f0f0"
            >
              <div class="d-flex flex-column align-items-center">
                <span style="font-size: 2rem; color: #1a5fad">+</span>
                <p class="small mt-2">Añadir jugador</p>
              </div>
            </div>
          </div>
          <!-- Botón de Notas -->
          <div
            class="text-center mt-4"
            id="notas-icono"
            style="cursor: pointer"
          >
            <i class="fa-regular fa-clipboard fa-xl"></i>
            <p class="small mt-1">Notas</p>
          </div>

          <!-- Modal Añadir Jugador -->
          <div
            class="modal fade"
            id="modalAddJugador"
            tabindex="-1"
            aria-labelledby="modalAddJugadorLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="modalAddJugadorLabel">
                    Nuevo Jugador
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Cerrar"
                  ></button>
                </div>
                <div class="modal-body">
                  <form id="formNuevoJugador">
                    <div class="mb-3">
                      <label for="nombreNuevo" class="form-label">Nombre</label>
                      <input
                        type="text"
                        class="form-control"
                        id="nombreNuevo"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="numeroNuevo" class="form-label">Número</label>
                      <input
                        type="number"
                        class="form-control"
                        id="numeroNuevo"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="posicionNuevo" class="form-label"
                        >Posición</label
                      >
                      <input
                        type="text"
                        class="form-control"
                        id="posicionNuevo"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="edadNuevo" class="form-label">Edad</label>
                      <input
                        type="number"
                        class="form-control"
                        id="edadNuevo"
                        required
                      />
                    </div>
                    <div class="mb-3">
                      <label for="fotoNuevo" class="form-label"
                        >URL de la imagen (opcional)</label
                      >
                      <input type="url" class="form-control" id="fotoNuevo" />
                    </div>
                    <button type="submit" class="btn btn-primary">
                      Agregar
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Notas generales estilo WhatsApp. Se guardan como si fueran asociadas a un jugador. -->
        </div>

        <!-- S2: Información del Jugador -->
        <div class="col-md-8 p-5" id="s2">
          <!-- Skeleton: por defecto visible -->
          <div id="jugador-skeleton">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center w-100">
                <div class="skeleton skeleton-img me-3"></div>
                <div class="w-100">
                  <div class="skeleton skeleton-line w-75"></div>
                  <div class="skeleton skeleton-line w-50"></div>
                  <div class="skeleton skeleton-line w-50"></div>
                </div>
              </div>
            </div>
          </div>

          <!-- Contenido real del jugador (oculto inicialmente) -->
          <div id="jugador-info" style="display: none">
            <div class="d-flex align-items-center justify-content-between mb-3">
              <div class="d-flex align-items-center">
                <img
                  id="jugador-img"
                  class="rounded-circle me-3"
                  style="width: 40%"
                />
                <div>
                  <h4 id="jugador-nombre">Nombre</h4>
                  <p class="mb-0">Edad: <span id="jugador-edad">--</span></p>
                  <p class="mb-0">
                    Posición: <span id="jugador-posicion">--</span>
                  </p>
                </div>
              </div>
              <button class="btn" onclick="toggleHistorial()">
                <i class="fa-solid fa-laptop-medical fa-xl"></i>
              </button>
            </div>

            <!-- Comentarios -->
            <div class="mb-4">
              <h5>Comentarios</h5>
              <div class="mb-3">
                <textarea
                  id="comentario-input"
                  class="form-control"
                  rows="4"
                  placeholder="Escribe un comentario..."
                ></textarea>
              </div>
              <div class="mb-3">
                <button
                  class="btn"
                  id="btn-comentar"
                  style="background-color: #1d337e; color: white"
                >
                  Guardar
                </button>
              </div>
            </div>

            <!-- Historial -->
            <div
              id="historialOverlay"
              class="overflow-auto timeline d-none"
              style="max-height: 500px"
            >
              <div
                class="d-flex justify-content-between align-items-center mb-2"
              >
                <h6 class="mb-0 h4">Historial de Comentarios</h6>
                <button
                  class="btn btn-sm btn-outline-danger"
                  onclick="toggleHistorial()"
                >
                  Cerrar
                </button>
              </div>
              <div class="overflow-auto" style="max-height: 300px"></div>
            </div>
          </div>
          <!-- Panel de Notas Generales -->
          <div id="notas-panel" style="display: none">
            <h4>Notas generales</h4>
            <div class="mb-3">
              <textarea
                id="nota-general-input"
                class="form-control"
                rows="4"
                placeholder="Escribe una nota..."
              ></textarea>
            </div>
            <button class="btn btn-primary mb-4" id="btn-guardar-nota">
              Guardar Nota
            </button>

            <h5>Historial</h5>
            <div
              id="historial-notas"
              class="overflow-auto"
              style="max-height: 300px"
            ></div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let jugadorActual = null;

        function seleccionarJugador(card) {
          const { nombre, numero, edad, posicion, img } = card.dataset;
          jugadorActual = nombre;

          const imgSrc =
            img || "https://via.placeholder.com/100x100.png?text=Jugador";
          document.getElementById("jugador-nombre").textContent = nombre;
          document.getElementById("jugador-edad").textContent = edad;
          document.getElementById("jugador-posicion").textContent = posicion;
          document.getElementById("jugador-img").src = imgSrc;

          document.getElementById("jugador-info").style.display = "block";
          document.getElementById("jugador-skeleton").style.display = "none";

          cargarComentarios(nombre);
        }

        function asignarEventosJugadorCard(card) {
          card.addEventListener("click", () => seleccionarJugador(card));
        }

        document
          .querySelectorAll(".jugador-card")
          .forEach(asignarEventosJugadorCard);

        const addBtn = document.getElementById("add-jugador-btn");
        if (addBtn) {
          addBtn.addEventListener("click", () => {
            const modal = new bootstrap.Modal(
              document.getElementById("modalAddJugador")
            );
            modal.show();
          });
        }

        const form = document.getElementById("formNuevoJugador");
        if (form) {
          form.addEventListener("submit", function (e) {
            e.preventDefault();

            const nombre = document.getElementById("nombreNuevo").value.trim();
            const numero = document.getElementById("numeroNuevo").value.trim();
            const posicion = document
              .getElementById("posicionNuevo")
              .value.trim();
            const edad = document.getElementById("edadNuevo").value.trim();
            const imgInput = document.getElementById("fotoNuevo").value.trim();
            const img =
              imgInput ||
              "https://via.placeholder.com/100x100.png?text=Jugador";

            if (!nombre || !numero || !posicion || !edad) return;

            const nuevaCard = document.createElement("div");
            nuevaCard.className =
              "col-12 col-sm-6 col-md-4 col-lg-3 text-center jugador-card";
            Object.assign(nuevaCard.dataset, {
              nombre,
              numero,
              posicion,
              edad,
              img,
            });

            nuevaCard.innerHTML = `<img src="${img}" alt="${nombre}" class="img-thumbnail" />
              <p class="small">${numero} - ${nombre}</p>`;

            const container = document.querySelector(".jugadores-lista");
            container.insertBefore(nuevaCard, addBtn);
            bootstrap.Modal.getInstance(
              document.getElementById("modalAddJugador")
            ).hide();
            this.reset();
            asignarEventosJugadorCard(nuevaCard);
          });
        }

        function cargarComentarios(nombre) {
          const comentarios =
            JSON.parse(localStorage.getItem("comentarios_" + nombre)) || [];
          const contenedor = document.getElementById("comentarios-lista");
          if (!contenedor) return;

          contenedor.innerHTML = "";
          comentarios
            .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
            .forEach((c) => {
              const div = document.createElement("div");
              div.classList.add("border", "rounded", "p-2", "mb-2", "bg-light");
              div.innerHTML = `<strong>${c.fecha}</strong><br>${c.texto}`;
              contenedor.appendChild(div);
            });
        }

        function guardarComentario(nombre, texto) {
          const comentarios =
            JSON.parse(localStorage.getItem("comentarios_" + nombre)) || [];
          comentarios.push({ texto, fecha: new Date().toISOString() });
          localStorage.setItem(
            "comentarios_" + nombre,
            JSON.stringify(comentarios)
          );

          const overlay = document.getElementById("historialOverlay");
          if (!overlay.classList.contains("d-none")) {
            renderizarHistorial();
          }
        }

        const comentarBtn = document.getElementById("btn-comentar");
        if (comentarBtn) {
          comentarBtn.addEventListener("click", () => {
            const texto = document
              .getElementById("comentario-input")
              .value.trim();
            if (!texto || !jugadorActual) return;
            guardarComentario(jugadorActual, texto);
            document.getElementById("comentario-input").value = "";
          });
        }

        function renderizarHistorial() {
          const overlay = document.getElementById("historialOverlay");
          if (!overlay || !jugadorActual) return;

          const contenedor = overlay.querySelector(".overflow-auto");
          contenedor.innerHTML = "";

          const comentarios =
            JSON.parse(localStorage.getItem("comentarios_" + jugadorActual)) ||
            [];

          if (comentarios.length === 0) {
            contenedor.innerHTML = `
        <div class="d-flex justify-content-center align-items-center" style="height: 200px;">
          <p class="text-muted">Historial vacío</p>
        </div>
      `;
            overlay.classList.add("empty");
          } else {
            overlay.classList.remove("empty");
            comentarios
              .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
              .forEach((c, index) => {
                const div = document.createElement("div");
                div.classList.add(
                  "timeline-entry",
                  index % 2 === 0 ? "left" : "right"
                );

                const fecha = new Date(c.fecha);
                const fechaTexto = `${String(fecha.getDate()).padStart(
                  2,
                  "0"
                )}-${String(fecha.getMonth() + 1).padStart(2, "0")}-${String(
                  fecha.getFullYear()
                ).slice(-2)}`;

                div.innerHTML = `
          <div class="border rounded p-2 bg-white position-relative">
            <div class="mb-1 text-muted small">${fechaTexto}</div>
            <div class="comentario-texto">${c.texto}</div>
            <div class="mt-2 text-end">
              <button class="btn btn-sm btn-outline-secondary me-2 editar-btn">Editar</button>
              <button class="btn btn-sm btn-outline-danger eliminar-btn">Eliminar</button>
            </div>
          </div>
        `;

                div
                  .querySelector(".editar-btn")
                  .addEventListener("click", () => {
                    const nuevoTexto = prompt("Editar comentario:", c.texto);
                    if (nuevoTexto?.trim()) {
                      comentarios[index].texto = nuevoTexto.trim();
                      localStorage.setItem(
                        "comentarios_" + jugadorActual,
                        JSON.stringify(comentarios)
                      );
                      renderizarHistorial();
                    }
                  });

                div
                  .querySelector(".eliminar-btn")
                  .addEventListener("click", () => {
                    if (confirm("¿Eliminar este comentario?")) {
                      comentarios.splice(index, 1);
                      localStorage.setItem(
                        "comentarios_" + jugadorActual,
                        JSON.stringify(comentarios)
                      );
                      renderizarHistorial();
                    }
                  });

                contenedor.appendChild(div);
              });
          }
        }

        function toggleHistorial() {
          const overlay = document.getElementById("historialOverlay");
          if (!overlay) return;

          if (overlay.classList.contains("d-none")) {
            renderizarHistorial();
            overlay.classList.remove("d-none");
          } else {
            overlay.classList.add("d-none");
          }
        }

        window.toggleHistorial = toggleHistorial; // 👈 importante si usas onclick="toggleHistorial()" en HTML

        const notasIcono = document.getElementById("notas-icono");
        if (notasIcono) {
          notasIcono.addEventListener("click", () => {
            document.getElementById("jugador-info").style.display = "none";
            document.getElementById("jugador-skeleton").style.display = "none";
            document.getElementById("notas-panel").style.display = "block";
            cargarNotasGenerales();
          });
        }

        function cargarNotasGenerales() {
          const notas = JSON.parse(localStorage.getItem("notas-panel")) || [];
          const historial = document.getElementById("historial-notas");
          if (!historial) return;

          historial.innerHTML =
            notas.length === 0
              ? "<p class='text-muted'>No hay notas guardadas todavía.</p>"
              : "";

          notas
            .sort((a, b) => new Date(b.fecha) - new Date(a.fecha))
            .forEach((nota, i) => {
              const div = document.createElement("div");
              div.className = "border rounded p-2 mb-2 bg-light";
              div.innerHTML = `
        <strong>${new Date(nota.fecha).toLocaleString()}</strong><br>
        <div class="nota-texto">${nota.texto}</div>
        <div class="mt-2 text-end">
          <button class="btn btn-sm btn-outline-secondary me-2 editar-nota">Editar</button>
          <button class="btn btn-sm btn-outline-danger eliminar-nota">Eliminar</button>
        </div>
      `;

              div
                .querySelector(".editar-nota")
                .addEventListener("click", () => {
                  const nuevoTexto = prompt("Editar nota:", nota.texto);
                  if (nuevoTexto?.trim()) {
                    notas[i].texto = nuevoTexto.trim();
                    localStorage.setItem("notas-panel", JSON.stringify(notas));
                    cargarNotasGenerales();
                  }
                });

              div
                .querySelector(".eliminar-nota")
                .addEventListener("click", () => {
                  if (confirm("¿Eliminar esta nota?")) {
                    notas.splice(i, 1);
                    localStorage.setItem("notas-panel", JSON.stringify(notas));
                    cargarNotasGenerales();
                  }
                });

              historial.appendChild(div);
            });
        }

        const guardarNotaBtn = document.getElementById("btn-guardar-nota");
        if (guardarNotaBtn) {
          guardarNotaBtn.addEventListener("click", () => {
            const texto = document
              .getElementById("nota-general-input")
              .value.trim();
            if (!texto) return;

            const notas = JSON.parse(localStorage.getItem("notas-panel")) || [];
            notas.push({ texto, fecha: new Date().toISOString() });
            localStorage.setItem("notas-panel", JSON.stringify(notas));

            document.getElementById("nota-general-input").value = "";
            cargarNotasGenerales();
          });
        }
      });
    </script>
  </body>
</html>
